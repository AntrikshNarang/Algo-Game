(()=>{var e={730:e=>{class a{constructor(e,a){this.number=e,this.color=a}getColor(){return this.color}getNumber(){return this.number}setNumber(e){this.number=e}setColor(e){this.color=e}generateRandomNumber(e=0,a){return Math.floor(Math.random()*(a-e)+e)}isCorrectGuess(e){return e===this.number}}function s(e){for(var a=e.length-1;a>0;a--)j=Math.floor(Math.random()*a),[e[a],e[j]]=[e[j],e[a]];return e}e.exports={AlgoCard:a,shuffle:s,getShuffledDeck:function(e){deck=[];for(var o=0;o<e/2;o++){var t=new a(o,"black");deck.push(t)}for(o=0;o<e/2;o++){t=new a(o,"white");deck.push(t)}return s(deck)},removeNums:function(e){var a=e;for(i=0;i<a.length;i++)a[i].setNumber(null);return a},sortPlayerHand:function(e){return e.sort(((e,a)=>e.getColor()!==a.getColor()&&e.getNumber()===a.getNumber()?"black"===e.getColor()?-1:1:e.getNumber()-a.getNumber())),e},ObjectArray_to_AlgoCardArray:function(e){for(var s=0;s<e.length;s++)e[s]=new a(e[s].number,e[s].color);return e},deepCopy:function(e){return JSON.parse(JSON.stringify(e))}}}},a={};function s(o){var t=a[o];if(void 0!==t)return t.exports;var r=a[o]={exports:{}};return e[o](r,r.exports,s),r.exports}s.d=(e,a)=>{for(var o in a)s.o(a,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:a[o]})},s.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a);var o={};(()=>{"use strict";s.d(o,{l:()=>E});var e=s(730);const a=$("#dealt-card"),t=$(".attack"),r=$(".hold"),n=$(".game-result"),l=$(".modal-game-result");function d(e){return"black"==e?"white":"black"}function c(e){const s=e.getNumber(),o=e.getColor();null!==s?a.html(s):a.html(""),a.removeClass(d(o)),a.addClass(o)}function m(){$("#return-button").click((()=>{l.removeClass("modal-in"),$("header").removeClass("display-none"),$("footer").removeClass("display-none"),$(".lobby").removeClass("display-none"),setTimeout((()=>{$(".desk-wrapper").removeClass("fade-in"),$(".main-bg").addClass("fade-in")}),1e3),setTimeout((()=>{$("header").removeClass("header-out"),$("footer").removeClass("footer-out"),$(".lobby").removeClass("fade-out"),l.addClass("display-none"),$(".desk-wrapper").addClass("display-none"),$(".enemy-disconnect").html("")}),1400)}))}function i(){t.click((()=>{E.myTurn&&E.socket.emit("attackMove",{guessTarget:E.selectedCard,guessValue:E.myGuessValue})})),r.click((()=>{E.myTurn&&E.socket.emit("holdMove")}))}const u=$("#guess-count"),y=$("#correct-guesses"),C=$("#guess-rate"),f=$("#stay-count"),g=$("#my-win-count"),p=$("#enemy-win-count"),h=$("#my-counter"),v=$("#enemy-counter");const k=$("#my-username"),b=$("#enemy-username"),w=$(".enemy-hand-container"),T=$(".guess-array"),x=$(".decision-wrapper");function A(){k.removeClass("player-turn"),b.addClass("player-turn"),w.addClass("no-pointer-events"),T.addClass("guess-array-inactive"),a.removeClass("highlight-dealt-card"),x.addClass("decision-fade-away"),t.addClass("decision-inactive"),r.addClass("decision-inactive")}function N(){k.addClass("player-turn"),b.removeClass("player-turn"),w.removeClass("no-pointer-events"),T.removeClass("guess-array-inactive"),a.addClass("highlight-dealt-card"),x.removeClass("decision-fade-away")}function G(e){$(e).removeClass("selected")}function V(e){n.removeClass("game-won"),n.removeClass("game-lost"),e?(n.html("YOU WIN"),n.addClass("game-won")):(n.html("YOU LOSE"),n.addClass("game-lost")),l.removeClass("display-none"),setTimeout((()=>{l.addClass("modal-in"),function(e){const a=Date.now()+8e3;let s=["#ffffff"],o=0,t=-30,r=-150;e?(s.push("#00bb00"),s.push("#e0c331")):(s.push("#bb0000"),s.push("#ff7575"),o=.9,t=60,r=120),function e(){confetti({zIndex:999,particleCount:2,angle:t,spread:60,origin:{x:0,y:o},colors:s,startVelocity:90}),confetti({zIndex:999,particleCount:2,angle:r,spread:60,origin:{x:1,y:o},colors:s,startVelocity:90}),Date.now()<a&&requestAnimationFrame(e)}()}(e)}),1600)}var Y=void 0,O=void 0,j=void 0;async function M(e,a){const s=$("#dealt-card").offset(),o=e.offset(),t={Y:s.top-o.top,X:s.left-o.left};(async function(e,a,s){e.hasClass("my-card")||e.hasClass("closed")?$.keyframe.define({name:`draw-${a.getColor()}-${a.getNumber()}`,"100%":{transform:`translate(${s.X}px, ${s.Y}px ) `}}):$.keyframe.define([{name:`draw-${a.getColor()}-${a.getNumber()}`,"0%":{color:`${d(a.getColor())}`,transform:"rotateY(0deg)"},"49%":{color:`${a.getColor()}`},"100%":{transform:`translate(${s.X}px, ${s.Y}px ) rotateY(180deg)`,color:`${a.getColor()}`}}])})(e,a,t).then((()=>{e.playKeyframe({name:`draw-${a.getColor()}-${a.getNumber()}`,duration:"0.4s",timingFunction:"ease",delay:"0s",direction:"reverse",fillMode:"both",complete:function(){e.css({"z-index":"10"})}})}))}function D(e){$(".hold").addClass("decision-inactive"),setTimeout((()=>{e.addClass("correct")}),600),setTimeout((()=>{j.play()}),800),setTimeout((()=>{e.removeClass("correct")}),1200)}function S(e,a){$(a).removeClass("selected"),$(a).addClass(e),setTimeout((()=>{$(a).removeClass(e)}),400)}function H(e,a,s,o){const t=function(e,a){const s=$("<div>");return s.addClass("card"),s.addClass(a),s.addClass(e.getColor()),s.html(e.getNumber()),s}(e,o);!function(e,a,s){const o=$(`.${s}-card`),t=o.length;if(e.addClass(`${s}-card`),a===t){let a=$("#my-hand");"enemy"===s&&(a=$("#enemy-hand")),a.append(e)}else $(o[a]).before(e)}(t,a,s),"enemy"===s&&function(e){const a=$(".enemy-card");for(let s=e;s<a.length;s++){const e=$(a[s]);e.hasClass("open")?e.off("click"):e.click((()=>{if(E.myTurn){$($(".enemy-card")[E.selectedCard]).removeClass("selected"),e.addClass("selected"),E.selectedCard=s,E.socket.emit("selectCard",{guessTarget:E.selectedCard}),I.removeClass("decision-inactive")}}))}}(a),M(t,e)}const I=$(".attack");function _(e){const a=$(".enemy-card")[e];$(a).off("click"),$(a).addClass("no-pointer-events")}let F;function z(){F.remove(),E.calloutActive=!1}var K=[],L=[],U=0,E={username:void 0,socket:void 0,myTurn:void 0,ready:!1,deckTop:void 0,selectedCard:0,myGuessValue:0,calloutActive:!1};$(document).ready((function(){const a=$("#ready-button"),s=$(".attack"),o=$(".hold"),t=$("#me"),r=$("#enemy");let n=r.html();const l=$("#ready-count"),d=$("#room-key").html();E.username=$("#me").html();1==parseInt(l.html())&&r.addClass("player-ready"),window.history.pushState(null,"",`/${d}/play`),async function(){$.keyframe.define({name:"flip-white-card","0%":{transform:"rotateY(180deg)",color:"white"},"30%":{color:"white"},"31%":{color:"black"},"100%":{transform:"rotateY(0deg)"}}),$.keyframe.define({name:"flip-black-card","0%":{transform:"rotateY(180deg)",color:"black"},"30%":{color:"black"},"31%":{color:"white"},"100%":{transform:"rotateY(0deg)"}}),$.keyframe.define({name:"hover-callout","0%":{transform:"translate(calc(5.5vh - 50%), -110%)"},"50%":{transform:"translate(calc(5.5vh - 50%), -140%)"},"100%":{transform:"translate(calc(5.5vh - 50%), -110%)"}})}(),Y=new Howl({src:["/sounds/ding.ogg"]}),O=new Howl({src:["/sounds/wrong.ogg"]}),j=new Howl({src:["/sounds/win.ogg"]}),setTimeout((()=>{$("header").removeClass("header-out"),$("footer").removeClass("footer-out"),$(".lobby").removeClass("fade-out")}),200),E.socket=io({query:{username:E.username,roomKey:d}}),E.socket.on("disconnect",(()=>{window.location.href=window.location.href})),E.socket.on("lobbyUpdate",(e=>{const a=e.usernames;n=function(e){let a=e[0];if(a===E.username&&(a=e[1]),null!==a)return $("#enemy").html(a),$("#enemy-username").html(a),$("#enemy-user-hth").html(a),a;$("#enemy").html("...")}(a)})),E.socket.on("readyUpdate",(e=>{l.html(e.readyCount);var s=e.userList[0];if(1!==e.userList.length){var o=e.userList[1];s.username!==E.username&&([s,o]=[o,s]),o.ready?r.addClass("player-ready"):r.removeClass("player-ready")}else r.removeClass("player-ready");s.ready?(t.addClass("player-ready"),a.addClass("ready-status")):(t.removeClass("player-ready"),a.removeClass("ready-status"))})),E.socket.on("startGame",(a=>{$(".lobby").addClass("fade-out"),$(".desk-wrapper").removeClass("display-none"),setTimeout((()=>{$("header").addClass("header-out"),$("footer").addClass("footer-out")}),1e3),setTimeout((()=>{$(".main-bg").removeClass("fade-in")}),1500),setTimeout((()=>{$(".lobby").addClass("display-none"),$("header").addClass("display-none"),$("footer").addClass("display-none"),$("#ready-button").removeClass("ready-status"),$(".desk-wrapper").addClass("fade-in"),E.ready=!1,$("#enemy").removeClass("player-ready"),$("#me").removeClass("player-ready"),$("#ready-count").html("0")}),2300),E.myTurn=a.yourTurn,E.deckTop=new e.AlgoCard(a.deckTop.number,a.deckTop.color),c(E.deckTop),$("#my-hand").html(""),$("#enemy-hand").html(""),K=(0,e.ObjectArray_to_AlgoCardArray)(a.yourHand),L=(0,e.ObjectArray_to_AlgoCardArray)(a.enemyHand),function(e,a){for(let a=0;a<e.length;a++)H(e[a],a,"my","closed");for(let e=0;e<a.length;e++)H(a[e],e,"enemy","closed")}(K,L),E.myTurn?N():A()})),E.socket.on("highlightCard",(e=>{var a,s,o;!function(e){let a=$(".my-card");$(a[E.selectedCard]).removeClass("selected"),E.selectedCard=e,$(a[E.selectedCard]).addClass("selected")}(e.index),a=E.selectedCard,s=K[E.selectedCard].getColor(),o=U,E.myTurn||(E.calloutActive&&F.remove(),F=$("<div>"),F.addClass("guess-callout"),F.addClass(s),F.html(o),$($(".my-card")[a]).prepend(F),E.calloutActive=!0,F.playKeyframe({name:"hover-callout",duration:"2s",timingFunction:"cubic-bezier(.48,.01,.49,.99)",iterationCount:"infinite"}))})),E.socket.on("updateButtonValue",(e=>{var a;U=e.buttonValue,a=U,F.html(a)})),E.socket.on("correctMove",(e=>{E.myTurn=e.yourTurn;var a=e.guessTarget,t=$(".enemy-card");let r=$(".my-card");Y.play(),E.myTurn?(S("correct",t[a]),$(t[a]).html(E.myGuessValue),$(t[a]).addClass("open"),s.addClass("decision-inactive"),o.removeClass("decision-inactive"),_(a),function(e,a){e.playKeyframe({name:`flip-${a.getColor()}-card`,duration:"0.4s",timingFunction:"ease",delay:"0s"})}($(t[a]),L[a])):($(r[a]).removeClass("closed"),$(r[a]).addClass("open"),S("correct",r[a]))})),E.socket.on("wrongMove",(a=>{const s=new e.AlgoCard(a.nextDeckTop.number,a.nextDeckTop.color),o=a.insertIndex;let t=E.deckTop;E.myTurn=a.yourTurn,O.play(),E.myTurn?(S("wrong",$(".my-card")[E.selectedCard]),t.setNumber(a.value),L.splice(o,0,t),H(t,o,"enemy","open"),_(o),z(),N()):(S("wrong",$(".enemy-card")[E.selectedCard]),K.splice(o,0,t),H(t,o,"my","open"),A()),c(s),E.deckTop=s})),E.socket.on("cardHeld",(a=>{const s=new e.AlgoCard(a.nextDeckTop.number,a.nextDeckTop.color),o=a.insertIndex,t=E.deckTop;E.myTurn=a.yourTurn,E.myTurn?(L.splice(o,0,t),H(t,o,"enemy","closed"),z(),G($(".my-card")[E.selectedCard]),N()):(K.splice(o,0,t),H(t,o,"my","open"),function(e,a){const s=$($(".my-card")[e]);setTimeout((()=>{s.addClass("closed"),s.removeClass("open")}),a)}(o,500),G($(".enemy-card")[E.selectedCard]),A()),c(s),E.deckTop=s})),E.socket.on("gameEnded",(e=>{let a=e.wonGame;var s;if(s=e.stats,u.html(s.totalGuesses),y.html(s.correctGuesses),C.html(`${s.correctGuessRate.toFixed(2)}%`),f.html(s.timesStayed),g.html(s.wins),p.html(s.losses),h.removeClass("game-won"),h.removeClass("game-lost"),h.removeClass("tie"),v.removeClass("game-won"),v.removeClass("game-lost"),v.removeClass("tie"),s.wins>s.losses?(h.addClass("game-won"),v.addClass("game-lost")):s.wins<s.losses?(h.addClass("game-lost"),v.addClass("game-won")):(h.addClass("tie"),v.addClass("tie")),e.enemyDisconnect)return $(".game-status").html("Enemy has disconnected!"),void V(a);a?(D($(".enemy-card")),$(".game-status").html(`You guessed all of ${n}'s cards!`)):(D($(".my-card")),$(".game-status").html(`${n} guessed all your cards!`)),V(a)})),E.socket.on("rejected",(()=>{console.log("reconnect not allowed")})),E.socket.on("afk-warning",(()=>{window.location.href="/afk"})),function(e){new ClipboardJS("#copy-key",{text:function(){return`https://playalgo.com/${e}/play`}}).on("success",(e=>{e.clearSelection()}))}(d),$("#ready-button").click((()=>{E.ready?E.ready=!1:E.ready=!0,E.socket.emit("readyConfirmation",{ready:E.ready})})),m(),i(),function(){const e=$(".guess-button");for(let a=0;a<12;a++)$(e[a]).click((()=>{E.myTurn&&($(e[E.myGuessValue]).removeClass("guess-button-selected"),E.myGuessValue=a,$(e[E.myGuessValue]).addClass("guess-button-selected"),E.socket.emit("buttonClicked",{buttonValue:E.myGuessValue}))}))}()}))})()})();