(()=>{"use strict";var e={d:(a,s)=>{for(var t in s)e.o(s,t)&&!e.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:s[t]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};e.d({},{l:()=>de});class a{constructor(e,a){this.number=e,this.color=a}getColor(){return this.color}getNumber(){return this.number}setNumber(e){this.number=e}setColor(e){this.color=e}generateRandomNumber(e=0,a){return Math.floor(Math.random()*(a-e)+e)}isCorrectGuess(e){return e===this.number}}function s(e){for(var s=0;s<e.length;s++)e[s]=new a(e[s].number,e[s].color);return e}const t=$("#dealt-card"),o=$(".attack"),n=$(".hold"),l=$(".game-result"),r=$(".game-status"),d=$(".modal-game-result");let c="YOU WIN",m="YOU LOSE",i="Enemy has disconnected!",u="You guessed all of <enemy>'s cards!",y="<enemy> guessed all your cards!";function C(e){return"black"==e?"white":"black"}function f(e){const a=e.getNumber(),s=e.getColor();null!==a?t.html(a):t.html(""),t.removeClass(C(s)),t.addClass(s)}function g(){$("#returnButton").click((()=>{d.removeClass("modal-in"),$("header").removeClass("display-none"),$("footer").removeClass("display-none"),$(".lobby").removeClass("display-none"),setTimeout((()=>{$(".desk-wrapper").removeClass("fade-in"),$(".main-bg").addClass("fade-in")}),1e3),setTimeout((()=>{$("header").removeClass("header-out"),$("footer").removeClass("footer-out"),$(".lobby").removeClass("fade-out"),d.addClass("display-none"),$(".desk-wrapper").addClass("display-none"),$(".enemy-disconnect").html("")}),1400)}))}function v(){o.click((()=>{de.myTurn&&de.socket.emit("attackMove",{guessTarget:de.selectedCard,guessValue:de.myGuessValue})})),n.click((()=>{de.myTurn&&de.socket.emit("holdMove")}))}const h=$("#guess-count"),p=$("#correct-guesses"),k=$("#guess-rate"),b=$("#stay-count"),w=$("#my-win-count"),T=$("#enemy-win-count"),x=$("#my-counter"),S=$("#enemy-counter");const G=$("#my-username"),V=$("#enemy-username"),I=$(".enemy-hand-container"),N=$(".guess-array"),Y=$(".decision-wrapper");function O(){G.removeClass("player-turn"),V.addClass("player-turn"),I.addClass("no-pointer-events"),N.addClass("guess-array-inactive"),t.removeClass("highlight-dealt-card"),Y.addClass("decision-fade-away"),o.addClass("decision-inactive"),n.addClass("decision-inactive")}function j(){G.addClass("player-turn"),V.removeClass("player-turn"),I.removeClass("no-pointer-events"),N.removeClass("guess-array-inactive"),t.addClass("highlight-dealt-card"),Y.removeClass("decision-fade-away")}function M(e){$(e).removeClass("selected")}function D(){let e=localStorage.getItem("lang");null!==e&&fetch(`/assets/languages/${e}.json`).then((e=>e.json())).then((e=>{const a=e.dynamic;c=a.gameWon,m=a.gameLost,i=a.disconnectStatus,u=a.wonStatus,y=a.lostStatus}))}function A(e,a,s){l.removeClass("game-won"),l.removeClass("game-lost"),s?(l.html(c),r.html(i),l.addClass("game-won")):e?(l.html(c),r.html(u.replace("<enemy>",a)),l.addClass("game-won")):(l.html(m),r.html(y.replace("<enemy>",a)),l.addClass("game-lost")),d.removeClass("display-none"),setTimeout((()=>{d.addClass("modal-in"),function(e){const a=Date.now()+8e3;let s=["#ffffff"],t=0,o=-30,n=-150;e?(s.push("#00bb00"),s.push("#e0c331")):(s.push("#bb0000"),s.push("#ff7575"),t=.9,o=60,n=120),function e(){confetti({zIndex:999,particleCount:2,angle:o,spread:60,origin:{x:0,y:t},colors:s,startVelocity:90}),confetti({zIndex:999,particleCount:2,angle:n,spread:60,origin:{x:1,y:t},colors:s,startVelocity:90}),Date.now()<a&&requestAnimationFrame(e)}()}(e)}),1600)}async function B(e,a){const s=$("#dealt-card").offset(),t=e.offset(),o={Y:s.top-t.top,X:s.left-t.left};(async function(e,a,s){e.hasClass("my-card")||e.hasClass("closed")?$.keyframe.define({name:`draw-${a.getColor()}-${a.getNumber()}`,"100%":{transform:`translate(${s.X}px, ${s.Y}px ) `}}):$.keyframe.define([{name:`draw-${a.getColor()}-${a.getNumber()}`,"0%":{color:`${C(a.getColor())}`,transform:"rotateY(0deg)"},"49%":{color:`${a.getColor()}`},"100%":{transform:`translate(${s.X}px, ${s.Y}px ) rotateY(180deg)`,color:`${a.getColor()}`}}])})(e,a,o).then((()=>{e.playKeyframe({name:`draw-${a.getColor()}-${a.getNumber()}`,duration:"0.4s",timingFunction:"ease",delay:"0s",direction:"reverse",fillMode:"both",complete:function(){e.css({"z-index":"10"})}})}))}function F(e){$(".hold").addClass("decision-inactive"),setTimeout((()=>{e.addClass("correct")}),600),setTimeout((()=>{e.removeClass("correct")}),1200)}function H(e,a){$(a).removeClass("selected"),$(a).addClass(e),setTimeout((()=>{$(a).removeClass(e)}),400)}var L=void 0,z=void 0;function K(){L.play()}function U(e){const a=Math.min(e,100)/100;L.volume(a),z.volume(a)}function E(e,a,s,t){const o=function(e,a){const s=$("<div>");return s.addClass("card"),s.addClass(a),s.addClass(e.getColor()),s.html(e.getNumber()),s}(e,t);!function(e,a,s){const t=$(`.${s}-card`),o=t.length;if(e.addClass(`${s}-card`),a===o){let a=$("#my-hand");"enemy"===s&&(a=$("#enemy-hand")),a.append(e)}else $(t[a]).before(e)}(o,a,s),"enemy"===s&&function(e){const a=$(".enemy-card");for(let s=e;s<a.length;s++){const e=$(a[s]);e.hasClass("open")?e.off("click"):e.click((()=>{if(de.myTurn){$($(".enemy-card")[de.selectedCard]).removeClass("selected"),e.addClass("selected"),de.selectedCard=s,de.socket.emit("selectCard",{guessTarget:de.selectedCard}),J.removeClass("decision-inactive")}}))}}(a),B(o,e)}const J=$(".attack");function X(e){const a=$(".enemy-card")[e];$(a).off("click"),$(a).addClass("no-pointer-events")}let q;function P(){q.remove(),de.calloutActive=!1}const R=$("#language-modal"),W=["en","ja"];function _(e){fetch(`/assets/languages/${e}.json`).then((e=>e.json())).then((e=>{const a=e.content;for(let[e,s]of Object.entries(a))"here"!==e&&("contrib"===e&&(s=`${s} <a href="https://github.com/notvalproate/Algo-Game" target="_blank">${a.here}</a>`),$(`#${e}`).html(s))}))}const Q=$("#settings-modal"),Z=$("#volumeSlider"),ee=$("#volumeIcon");let ae;function se(){!function(){let e=localStorage.getItem("volume");null===e?ae=2:(e=JSON.parse(e),ae=oe(e.volume),Z.attr("value",`${e.volume}`),U(e.volume),te())}(),$("#settingsButton").click((()=>{Q.removeClass("display-none"),setTimeout((()=>{Q.addClass("settings-modal-fade-in")}),50)})),$("#closeButton").click((()=>{Q.removeClass("settings-modal-fade-in"),setTimeout((()=>{Q.addClass("display-none")}),500)})),Z.on("pointerup touchend",(()=>{const e=Z.val();localStorage.setItem("volume",JSON.stringify({volume:e})),ae=oe(e),te(),U(Z.val()),K()}))}function te(){ee.removeClass("fa-volume-high"),ee.removeClass("fa-volume-low"),ee.removeClass("fa-volume-xmark"),0===ae?ee.addClass("fa-volume-xmark"):1===ae?ee.addClass("fa-volume-low"):ee.addClass("fa-volume-high")}function oe(e){return e<=.1?0:e<=50?1:2}var ne=[],le=[],re=0,de={username:void 0,socket:void 0,myTurn:void 0,ready:!1,deckTop:void 0,selectedCard:0,myGuessValue:0,calloutActive:!1};$(document).ready((function(){const e=$("#ready-button"),t=$(".attack"),o=$(".hold"),n=$("#me"),l=$("#enemy");let r=l.html();const d=$("#ready-count"),c=$("#room-key").html();de.username=$("#me").html();1==parseInt(d.html())&&l.addClass("player-ready"),window.history.pushState(null,"",`/${c}/play`),async function(){$.keyframe.define({name:"flip-white-card","0%":{transform:"rotateY(180deg)",color:"white"},"30%":{color:"white"},"31%":{color:"black"},"100%":{transform:"rotateY(0deg)"}}),$.keyframe.define({name:"flip-black-card","0%":{transform:"rotateY(180deg)",color:"black"},"30%":{color:"black"},"31%":{color:"white"},"100%":{transform:"rotateY(0deg)"}}),$.keyframe.define({name:"hover-callout","0%":{transform:"translate(calc(5.5vh - 50%), -110%)"},"50%":{transform:"translate(calc(5.5vh - 50%), -140%)"},"100%":{transform:"translate(calc(5.5vh - 50%), -110%)"}})}(),L=new Howl({src:["/assets/sounds/ding.ogg"]}),z=new Howl({src:["/assets/sounds/wrong.ogg"]}),setTimeout((()=>{$("header").removeClass("header-out"),$("footer").removeClass("footer-out"),$(".lobby").removeClass("fade-out")}),200),de.socket=io({query:{username:de.username,roomKey:c}}),de.socket.on("disconnect",(()=>{window.location.href=window.location.href})),de.socket.on("lobbyUpdate",(e=>{const a=e.usernames;r=function(e){let a=e[0];if(a===de.username&&(a=e[1]),null!==a)return $("#enemy").html(a),$("#enemy-username").html(a),$("#enemy-user-hth").html(a),a;$("#enemy").html("...")}(a)})),de.socket.on("readyUpdate",(a=>{d.html(a.readyCount);var s=a.userList[0];if(1!==a.userList.length){var t=a.userList[1];s.username!==de.username&&([s,t]=[t,s]),t.ready?l.addClass("player-ready"):l.removeClass("player-ready")}else l.removeClass("player-ready");s.ready?(n.addClass("player-ready"),e.addClass("ready-status")):(n.removeClass("player-ready"),e.removeClass("ready-status"))})),de.socket.on("startGame",(e=>{$(".lobby").addClass("fade-out"),$(".desk-wrapper").removeClass("display-none"),setTimeout((()=>{$("header").addClass("header-out"),$("footer").addClass("footer-out")}),1e3),setTimeout((()=>{$(".main-bg").removeClass("fade-in")}),1500),setTimeout((()=>{$(".lobby").addClass("display-none"),$("header").addClass("display-none"),$("footer").addClass("display-none"),$("#ready-button").removeClass("ready-status"),$(".desk-wrapper").addClass("fade-in"),de.ready=!1,$("#enemy").removeClass("player-ready"),$("#me").removeClass("player-ready"),$("#ready-count").html("0")}),2300),de.myTurn=e.yourTurn,de.deckTop=new a(e.deckTop.number,e.deckTop.color),f(de.deckTop),$("#my-hand").html(""),$("#enemy-hand").html(""),ne=s(e.yourHand),le=s(e.enemyHand),function(e,a){for(let a=0;a<e.length;a++)E(e[a],a,"my","closed");for(let e=0;e<a.length;e++)E(a[e],e,"enemy","closed")}(ne,le),de.myTurn?j():O()})),de.socket.on("highlightCard",(e=>{var a,s,t;!function(e){let a=$(".my-card");$(a[de.selectedCard]).removeClass("selected"),de.selectedCard=e,$(a[de.selectedCard]).addClass("selected")}(e.index),a=de.selectedCard,s=ne[de.selectedCard].getColor(),t=re,de.myTurn||(de.calloutActive&&q.remove(),q=$("<div>"),q.addClass("guess-callout"),q.addClass(s),q.html(t),$($(".my-card")[a]).prepend(q),de.calloutActive=!0,q.playKeyframe({name:"hover-callout",duration:"2s",timingFunction:"cubic-bezier(.48,.01,.49,.99)",iterationCount:"infinite"}))})),de.socket.on("updateButtonValue",(e=>{var a;re=e.buttonValue,a=re,q.html(a)})),de.socket.on("correctMove",(e=>{de.myTurn=e.yourTurn;var a=e.guessTarget,s=$(".enemy-card");let n=$(".my-card");var l,r;K(),de.myTurn?(H("correct",s[a]),$(s[a]).html(de.myGuessValue),$(s[a]).addClass("open"),t.addClass("decision-inactive"),o.removeClass("decision-inactive"),X(a),l=$(s[a]),r=le[a],l.playKeyframe({name:`flip-${r.getColor()}-card`,duration:"0.4s",timingFunction:"ease",delay:"0s"})):($(n[a]).removeClass("closed"),$(n[a]).addClass("open"),H("correct",n[a]))})),de.socket.on("wrongMove",(e=>{const s=new a(e.nextDeckTop.number,e.nextDeckTop.color),t=e.insertIndex;let o=de.deckTop;de.myTurn=e.yourTurn,z.play(),de.myTurn?(H("wrong",$(".my-card")[de.selectedCard]),o.setNumber(e.value),le.splice(t,0,o),E(o,t,"enemy","open"),X(t),P(),j()):(H("wrong",$(".enemy-card")[de.selectedCard]),ne.splice(t,0,o),E(o,t,"my","open"),O()),f(s),de.deckTop=s})),de.socket.on("cardHeld",(e=>{const s=new a(e.nextDeckTop.number,e.nextDeckTop.color),t=e.insertIndex,o=de.deckTop;de.myTurn=e.yourTurn,de.myTurn?(le.splice(t,0,o),E(o,t,"enemy","closed"),P(),M($(".my-card")[de.selectedCard]),j()):(ne.splice(t,0,o),E(o,t,"my","open"),function(e,a){const s=$($(".my-card")[e]);setTimeout((()=>{s.addClass("closed"),s.removeClass("open")}),a)}(t,500),M($(".enemy-card")[de.selectedCard]),O()),f(s),de.deckTop=s})),de.socket.on("gameEnded",(e=>{let a=e.wonGame;var s;s=e.stats,h.html(s.totalGuesses),p.html(s.correctGuesses),k.html(`${s.correctGuessRate.toFixed(2)}%`),b.html(s.timesStayed),w.html(s.wins),T.html(s.losses),x.removeClass("game-won"),x.removeClass("game-lost"),x.removeClass("tie"),S.removeClass("game-won"),S.removeClass("game-lost"),S.removeClass("tie"),s.wins>s.losses?(x.addClass("game-won"),S.addClass("game-lost")):s.wins<s.losses?(x.addClass("game-lost"),S.addClass("game-won")):(x.addClass("tie"),S.addClass("tie")),e.enemyDisconnect?A(a,r,!0):(F(a?$(".enemy-card"):$(".my-card")),A(a,r,!1))})),de.socket.on("rejected",(()=>{console.log("reconnect not allowed")})),de.socket.on("afk-warning",(()=>{window.location.href="/afk"})),function(e){new ClipboardJS("#copy-key",{text:function(){return`https://playalgo.com/${e}/play`}}).on("success",(e=>{e.clearSelection()}))}(c),$("#ready-button").click((()=>{de.ready?de.ready=!1:de.ready=!0,de.socket.emit("readyConfirmation",{ready:de.ready})})),g(),v(),function(){const e=$(".guess-button");for(let a=0;a<12;a++)$(e[a]).click((()=>{de.myTurn&&($(e[de.myGuessValue]).removeClass("guess-button-selected"),de.myGuessValue=a,$(e[de.myGuessValue]).addClass("guess-button-selected"),de.socket.emit("buttonClicked",{buttonValue:de.myGuessValue}))}))}(),D(),function(e){$("#languageButton").click((()=>{R.removeClass("display-none"),setTimeout((()=>{R.addClass("language-modal-fade-in")}),50)}));for(let a=0;a<W.length;a++){const s=W[a];$(`#${s}Option`).click((()=>{localStorage.setItem("lang",s),_(s),R.removeClass("language-modal-fade-in"),setTimeout((()=>{R.addClass("display-none")}),500),e()}))}}(D),function(){const e=localStorage.getItem("lang");null!==e&&"en"!==e&&_(e)}(),se()}))})();